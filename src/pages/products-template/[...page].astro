---
export const prerender = true;

import SecondaryPageLayout from '../../components/templates/SecondaryPageLayout.astro';
import GridList from '../../components/templates/GridList.astro';
import Pagination from '../../components/templates/Pagination.astro';
import { products } from '../../data/products.js';

// 为分页生成静态路径
export function getStaticPaths() {
  const productsPerPage = 9; // 每页显示9个产品（3行x3列）
  const totalPages = Math.ceil(products.length / productsPerPage);
  
  // 生成分页路径
  const paths = [];
  
  // 第一页 (可以用 /products-template 或 /products-template/1 访问)
  paths.push({
    params: { page: undefined },
    props: { 
      currentPage: 1,
      totalPages,
      products: products.slice(0, productsPerPage)
    }
  });
  
  // 其他页面
  for (let i = 2; i <= totalPages; i++) {
    paths.push({
      params: { page: i.toString() },
      props: {
        currentPage: i,
        totalPages,
        products: products.slice((i - 1) * productsPerPage, i * productsPerPage)
      }
    });
  }
  
  return paths;
}

const { currentPage, totalPages, products: pageProducts } = Astro.props;

// 转换产品数据格式以适配GridList组件
const gridItems = pageProducts.map(product => ({
  id: product.id,
  title: product.name,
  image: product.image,
  excerpt: product.excerpt,
  category: product.category,
  href: `/products/${product.slug}`
}));

// 面包屑导航
const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: 'Products', href: '/products' },
  { label: 'All Products' }
];
---

<SecondaryPageLayout 
  title="All Products"
  description="Browse our complete range of construction machinery and equipment"
  breadcrumbs={breadcrumbs}
  currentSection="products"
  contentType="grid"
>
  <!-- 产品网格 -->
  <GridList 
    items={gridItems}
    itemsPerRow={3}
    maxRows={3}
  />
  
  <!-- 分页 -->
  <Pagination 
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/products-template"
    i18n={{
      paging: {
        previous: "上一页",
        next: "下一页",
        page: "第",
        of: "页，共",
        first: "首页",
        last: "尾页",
        showing: "显示",
        to: "到",
        ofTotal: "共",
        items: "项",
        pages: "页"
      },
      aria: {
        pagination: "分页导航",
        previous: "上一页",
        next: "下一页",
        page: "跳转到第",
        first: "跳转到首页",
        last: "跳转到尾页"
      }
    }}
  />
</SecondaryPageLayout> 