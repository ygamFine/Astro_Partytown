---
export const prerender = true;

import SecondaryPageLayout from '../../components/templates/SecondaryPageLayout.astro';
import GridList from '../../components/templates/GridList.astro';
import Pagination from '../../components/templates/Pagination.astro';
import { allCases } from '../../data/cases.js';

// 为分页生成静态路径
export function getStaticPaths() {
  const casesPerPage = 6; // 每页显示6个案例（2行x3列）
  const totalPages = Math.ceil(allCases.length / casesPerPage);
  
  // 生成分页路径
  const paths = [];
  
  // 第一页 (可以用 /case 或 /case/1 访问)
  paths.push({
    params: { page: undefined },
    props: { 
      currentPage: 1,
      totalPages,
      cases: allCases.slice(0, casesPerPage)
    }
  });
  
  // 其他页面
  for (let i = 2; i <= totalPages; i++) {
    paths.push({
      params: { page: i.toString() },
      props: {
        currentPage: i,
        totalPages,
        cases: allCases.slice((i - 1) * casesPerPage, i * casesPerPage)
      }
    });
  }
  
  return paths;
}

const { currentPage, totalPages, cases } = Astro.props;

// 转换案例数据格式以适配GridList组件
const gridItems = cases.map(caseItem => ({
  id: caseItem.id,
  title: caseItem.title,
  image: caseItem.image,
  excerpt: caseItem.excerpt,
  category: caseItem.category,
  href: `/case/${caseItem.id}` // 假设有详情页面
}));

// 面包屑导航
const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: 'Cases' }
];
---

<SecondaryPageLayout 
  title="Customer Cases"
  description="Discover how our machinery solutions have helped customers achieve success across various industries"
  breadcrumbs={breadcrumbs}
  currentSection="cases"
  contentType="grid"
>
  <!-- 案例网格 -->
  <GridList 
    items={gridItems}
    itemsPerRow={3}
    maxRows={2}
    mode="case"
  />
  
  <!-- 分页 -->
  <Pagination 
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/case"
  />
</SecondaryPageLayout> 