---
// æ ¹è·¯å¾„é¦–é¡µ - ç”¨äºå­åŸŸåè®¿é—®ï¼Œç›´æ¥æ¸²æŸ“å†…å®¹
export const prerender = true;
import { REVALIDATE_TIME } from '../lib/isrConfig.js';
export const revalidate = REVALIDATE_TIME.HOME;

import Layout from '../layouts/Layout.astro';
import FullScreenBanner from '../components/common/banner/FullScreenBanner.astro';
import HeroShowcase from '../components/common/banner/HeroShowcase.astro';
import ProductShowcase from '../components/ProductShowcase.astro';
import CustomerNeeds from '../components/CustomerNeeds.astro';
import CustomerCases from '../components/CustomerCases.astro';
import NewsCenter from '../components/NewsCenter.astro';
import HotRecommendedProducts from '../components/HotRecommendedProducts.astro';
import StatsSection from '../components/StatsSection.astro';

import { themeConfig } from '../config/theme.js';

// æ ¹æ®å­åŸŸåç¡®å®šè¯­è¨€
const hostname = Astro.url.hostname;
const url = Astro.url.pathname;

// è°ƒè¯•ä¿¡æ¯
console.log('ğŸŒ æ£€æµ‹åˆ°ä¸»æœºå:', hostname);
console.log('ğŸ”— å½“å‰è·¯å¾„:', url);

let lang = 'en'; // é»˜è®¤è‹±æ–‡

// å­åŸŸååˆ°è¯­è¨€çš„æ˜ å°„
const subdomainToLang = {
  'zh': 'zh-CN',
  'zh-hant': 'zh-Hant',
  'de': 'de',
  'ja': 'ja',
  'fr': 'fr',
  'ar': 'ar',
  'es': 'es',
  'it': 'it',
  'pt': 'pt-pt',
  'nl': 'nl',
  'pl': 'pl',
  'ru': 'ru',
  'th': 'th',
  'id': 'id',
  'vi': 'vi',
  'ms': 'ms',
  'ml': 'ml',
  'my': 'my',
  'hi': 'hi',
  'ko': 'ko',
  'tr': 'tr'
};

// æ£€æŸ¥å­åŸŸå
let detectedSubdomain = null;
for (const [subdomain, language] of Object.entries(subdomainToLang)) {
  if (hostname.startsWith(`${subdomain}.`)) {
    lang = language;
    detectedSubdomain = subdomain;
    console.log(`âœ… æ£€æµ‹åˆ°å­åŸŸå ${subdomain}ï¼Œè®¾ç½®è¯­è¨€ä¸º ${language}`);
    break;
  }
}

// æ£€æŸ¥æ˜¯å¦æ˜¯ä¸»åŸŸåï¼ˆéå­åŸŸåï¼‰
const isMainDomain = !hostname.includes('.') || hostname.split('.').length <= 2;
if (isMainDomain && !detectedSubdomain) {
  lang = 'en';
  console.log('ğŸ  ä¸»åŸŸåï¼Œä½¿ç”¨é»˜è®¤è‹±è¯­');
}

console.log(`ğŸ¯ æœ€ç»ˆè¯­è¨€è®¾ç½®: ${lang}`);
console.log(`ğŸ—ï¸ ç¯å¢ƒ: ${import.meta.env.DEV ? 'å¼€å‘' : 'ç”Ÿäº§'}`);

// å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒä¸”æ£€æµ‹åˆ°å­åŸŸåï¼Œé‡å®šå‘åˆ°å¯¹åº”çš„è¯­è¨€è·¯å¾„
if (import.meta.env.PROD && detectedSubdomain && !hostname.includes('localhost')) {
  const targetPath = `/${lang}${url === '/' ? '' : url}`;
  console.log(`ğŸ”„ ç”Ÿäº§ç¯å¢ƒé‡å®šå‘åˆ°: ${targetPath}`);
  return Astro.redirect(targetPath);
}

// å¼€å‘ç¯å¢ƒä¸‹çš„é‡å®šå‘é€»è¾‘
if (import.meta.env.DEV && detectedSubdomain) {
  const targetPath = `/${lang}${url === '/' ? '' : url}`;
  console.log(`ğŸ”„ å¼€å‘ç¯å¢ƒé‡å®šå‘åˆ°: ${targetPath}`);
  return Astro.redirect(targetPath);
}

// è·å–é¡µé¢å®½åº¦é…ç½®
const getPageWidth = () => {
  return themeConfig.layout.dynamicWidth.getPageWidth('home');
};

const pageWidth = getPageWidth();
---

<Layout title="ä¸“ä¸šæ»‘ç§»è£…è½½æœºåˆ¶é€ å•†" lang={lang} pageType="home">
	<main>
		<FullScreenBanner />
		<div class="container mx-auto px-4" style={`max-width: ${pageWidth}`}>
			<HeroShowcase />
			<ProductShowcase />
			<StatsSection />
			<HotRecommendedProducts />
			<CustomerNeeds />
			<CustomerCases />
			<NewsCenter />
		</div>
	</main>
</Layout> 