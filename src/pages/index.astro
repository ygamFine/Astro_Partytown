---
// 根路径首页 - 用于子域名访问，直接渲染内容
export const prerender = true;
import { REVALIDATE_TIME } from '../lib/isrConfig.js';
export const revalidate = REVALIDATE_TIME.HOME;

import Layout from '../layouts/Layout.astro';
import FullScreenBanner from '../components/common/banner/FullScreenBanner.astro';
import HeroShowcase from '../components/common/banner/HeroShowcase.astro';
import ProductShowcase from '../components/ProductShowcase.astro';
import CustomerNeeds from '../components/CustomerNeeds.astro';
import CustomerCases from '../components/CustomerCases.astro';
import NewsCenter from '../components/NewsCenter.astro';
import HotRecommendedProducts from '../components/HotRecommendedProducts.astro';
import StatsSection from '../components/StatsSection.astro';

import { themeConfig } from '../config/theme.js';

// 根据子域名确定语言
const hostname = Astro.url.hostname;
const url = Astro.url.pathname;

// 调试信息
console.log('🌐 检测到主机名:', hostname);
console.log('🔗 当前路径:', url);

let lang = 'en'; // 默认英文

// 子域名到语言的映射
const subdomainToLang = {
  'zh': 'zh-CN',
  'zh-hant': 'zh-Hant',
  'de': 'de',
  'ja': 'ja',
  'fr': 'fr',
  'ar': 'ar',
  'es': 'es',
  'it': 'it',
  'pt': 'pt-pt',
  'nl': 'nl',
  'pl': 'pl',
  'ru': 'ru',
  'th': 'th',
  'id': 'id',
  'vi': 'vi',
  'ms': 'ms',
  'ml': 'ml',
  'my': 'my',
  'hi': 'hi',
  'ko': 'ko',
  'tr': 'tr'
};

// 检查子域名
let detectedSubdomain = null;
for (const [subdomain, language] of Object.entries(subdomainToLang)) {
  if (hostname.startsWith(`${subdomain}.`)) {
    lang = language;
    detectedSubdomain = subdomain;
    console.log(`✅ 检测到子域名 ${subdomain}，设置语言为 ${language}`);
    break;
  }
}

// 检查是否是主域名（非子域名）
const isMainDomain = !hostname.includes('.') || hostname.split('.').length <= 2;
if (isMainDomain && !detectedSubdomain) {
  lang = 'en';
  console.log('🏠 主域名，使用默认英语');
}

console.log(`🎯 最终语言设置: ${lang}`);
console.log(`🏗️ 环境: ${import.meta.env.DEV ? '开发' : '生产'}`);

// 如果是生产环境且检测到子域名，重定向到对应的语言路径
if (import.meta.env.PROD && detectedSubdomain && !hostname.includes('localhost')) {
  const targetPath = `/${lang}${url === '/' ? '' : url}`;
  console.log(`🔄 生产环境重定向到: ${targetPath}`);
  return Astro.redirect(targetPath);
}

// 开发环境下的重定向逻辑
if (import.meta.env.DEV && detectedSubdomain) {
  const targetPath = `/${lang}${url === '/' ? '' : url}`;
  console.log(`🔄 开发环境重定向到: ${targetPath}`);
  return Astro.redirect(targetPath);
}

// 获取页面宽度配置
const getPageWidth = () => {
  return themeConfig.layout.dynamicWidth.getPageWidth('home');
};

const pageWidth = getPageWidth();
---

<Layout title="专业滑移装载机制造商" lang={lang} pageType="home">
	<main>
		<FullScreenBanner />
		<div class="container mx-auto px-4" style={`max-width: ${pageWidth}`}>
			<HeroShowcase />
			<ProductShowcase />
			<StatsSection />
			<HotRecommendedProducts />
			<CustomerNeeds />
			<CustomerCases />
			<NewsCenter />
		</div>
	</main>
</Layout> 