---
export const prerender = true;
export const revalidate = 60;

import { getProducts } from '../../../lib/strapi.js';
import { getEnabledLanguages } from '../../../lib/i18n-config.js';

export async function getStaticPaths() {
  const paths: any[] = [];
  const enabledLanguages = getEnabledLanguages();
  
  for (const lang of enabledLanguages) {
    const products = await getProducts(lang);
    const totalPages = Math.ceil(products.length / 9);
    
    if (totalPages > 0) {
      // 第一页
      paths.push({
        params: { lang, page: undefined },
        props: { lang, currentPage: 1, totalPages }
      });
      
      // 其他页面
      for (let page = 2; page <= totalPages; page++) {
        paths.push({
          params: { lang, page: page.toString() },
          props: { lang, currentPage: page, totalPages }
        });
      }
    }
  }
  
  return paths;
}

const { slug } = Astro.params;
const { lang, currentPage, totalPages } = Astro.props;
const post = await getProducts(lang);
console.log(post);
---

<html>
  <head><title>Products</title></head>
  <body>
    <h1>Products</h1>
    <p>Page {currentPage} of {totalPages}</p>
    <p>Products count: {post.length}</p>
    
    <div>
      {post.map((item) => (
        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
          <h3>{item.name}</h3>
          <p>ID: {item.id}</p>
          <p>Slug: {item.slug}</p>
          <p>Category: {item.category}</p>
          <p>Price: {item.price}</p>
          <p>Excerpt: {item.excerpt}</p>
          <p>Images: {JSON.stringify(item.image)}</p>
        </div>
      ))}
    </div>
  </body>
</html>
