---
export const prerender = true;

import SecondaryPageLayout from "@components/templates/layout/SecondaryPageLayout.astro";
import { getDictionary } from "@i18n/dictionaries";
import { generateCategoryBreadcrumbs } from "@utils/breadcrumbUtils";
import { SUPPORTED_LANGUAGES } from "@utils/i18n-routes";
import { getSinglepages } from "@apis/common";
import RichText from "@components/common/layout/RichText.astro";
// 使用 Astro 内置的 i18n 路由
export async function getStaticPaths() {
  const paths = [];
  for (const lang of SUPPORTED_LANGUAGES) {
    const res = await getSinglepages(lang);
    const singlepages = Array.isArray(res) ? res : [];
    for (const singlepage of singlepages) {
      const rawSlug = (singlepage?.url_slug || "").toString();
      // 直接使用原始slug，不添加/singlepage前缀
      // 这样 /en/cookie-policy/ 就能正确生成
      const slug = rawSlug.startsWith('/') ? rawSlug : `/${rawSlug}`;
      paths.push({
        params: {
          lang,
          sp: slug,
        },
        props: {
          lang,
          title: singlepage?.title || "",
          details: singlepage?.details || "",
          url_slug: slug,
        },
      });
    }
  }
  return paths;
}

const { lang, title, details, url_slug } = Astro.props;
const t = await getDictionary(lang);

// 面包屑导航

const breadcrumbs =
  url_slug === "/about"
    ? generateCategoryBreadcrumbs(
        lang,
        { path: "", name: "" },
        "/about",
        t.about.title,
      )
    : generateCategoryBreadcrumbs(
        lang,
        { path: url_slug, name: title || t.about.title },
        "/about",
        t.about.title,
      );
---

<SecondaryPageLayout
  title={title || t.about.title}
  breadcrumbs={breadcrumbs}
  currentSection="about"
  contentType="content"
  lang={lang}
  pageType="about"
  showListDescription={true}
  hideSidebar={true}
>
  <RichText content={details} />
</SecondaryPageLayout>

