---
// 移除 prerender = true，允许 SSR
export const revalidate = 3600; // 1小时

import Layout from '@layouts/Layout.astro';
import FullScreenBanner from '@components/Custom/Home/FullScreenBanner.astro';
import ProductShowcase from '@components/Custom/Home/ProductShowcase.astro';
import StatsSection from '@components/Custom/Home/StatsSection.astro';
import HotRecommendedProducts from '@components/Custom/Home/HotRecommendedProduct.astro';
import FrontContactUs from '@components/Custom/Home/FrontContactUs.astro';
import CustomerNeeds from '../../components/CustomerNeeds.astro';
import CustomerCases from '@components/Custom/Home/CustomerCases.astro';
import CustomerNews from '@components/Custom/Home/CustomerNews.astro';


import { themeConfig } from '../../config/theme.js';
import { generateCommonStaticPaths } from '@utils/pageUtils'
import { getHomepageContent } from '@apis/home';
import { getDictionary } from '../../i18n/dictionaries.ts';

// 使用 Astro 内置的 i18n 路由
export async function getStaticPaths() {
  return generateCommonStaticPaths();
}

const { lang } = Astro.params;
const t = await getDictionary(lang);

// 获取首页数据
const homepageData = await getHomepageContent(lang);
// 获取页面宽度配置
const getPageWidth = () => {
  return themeConfig.layout.dynamicWidth.getPageWidth('home');
};
const pageWidth = getPageWidth();
---


<Layout title={t.nav.home} lang={lang} pageType="home">
	<FullScreenBanner />
	<!-- <div class="container mx-auto px-4" style={`max-width: ${pageWidth}`}> -->
	<div class="mx-auto">		
		<ProductShowcase data={homepageData?.productShowcase} lang={lang} />
		<StatsSection companyData={homepageData?.companyIntroduction} corporateAdvantages={homepageData?.corporateAdvantages} />
		
		<!-- 使用 server:defer 延迟渲染热门推荐产品 -->
		<div server:defer>
			<HotRecommendedProducts data={homepageData?.hotRecommendedProducts} lang={lang} />
		</div>
		
		<FrontContactUs frontContactUs={homepageData?.frontContactUs} />
		
		<!-- 使用 server:defer 延迟渲染客户案例 -->
		<div server:defer>
			<CustomerCases customerCases={homepageData?.customerCases} lang={lang} />
		</div>
		
		<!-- 使用 server:defer 延迟渲染客户新闻 -->
		<div server:defer>
			<CustomerNews customerNews={homepageData?.customerNews} lang={lang} />
		</div>
		<!-- 
		<StatsSection 
			companyData={homepageData?.companyIntroduction}
		/>
		
		<CustomerNeeds 
			contactData={homepageData?.contactUs}
		/>
		
		<NewsCenter /> -->
	</div>
</Layout>
