---
export const prerender = true;

import SecondaryPageLayout from '../../components/templates/SecondaryPageLayout.astro';
import NewsList from '../../components/templates/NewsList.astro';
import Pagination from '../../components/templates/Pagination.astro';
import { allNews } from '../../data/news.js';

// 为分页生成静态路径
export function getStaticPaths() {
  const newsPerPage = 6; // 每页显示的新闻数量
  const totalPages = Math.ceil(allNews.length / newsPerPage);
  
  // 生成分页路径
  const paths = [];
  
  // 第一页 (可以用 /news 或 /news/1 访问)
  paths.push({
    params: { page: undefined },
    props: { 
      currentPage: 1,
      totalPages,
      news: allNews.slice(0, newsPerPage)
    }
  });
  
  // 其他页面
  for (let i = 2; i <= totalPages; i++) {
    paths.push({
      params: { page: i.toString() },
      props: {
        currentPage: i,
        totalPages,
        news: allNews.slice((i - 1) * newsPerPage, i * newsPerPage)
      }
    });
  }
  
  return paths;
}

const { currentPage, totalPages, news } = Astro.props;

// 按日期倒序排序新闻并转换数据格式
const sortedNews = news.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
const newsItems = sortedNews.map(newsItem => ({
  id: newsItem.id,
  title: newsItem.title,
  image: newsItem.image,
  excerpt: newsItem.excerpt,
  date: newsItem.date,
  href: `/news/${newsItem.slug}`,
}));

// 面包屑导航
const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: 'News' }
];
---

<SecondaryPageLayout 
  title="News Center"
  description="Stay updated with our latest news and industry insights"
  breadcrumbs={breadcrumbs}
  currentSection="news"
  contentType="list"
>
  <!-- 新闻列表 -->
  <NewsList 
    items={newsItems}
  />
  
  <!-- 分页 -->
  <Pagination 
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/news"
  />
</SecondaryPageLayout> 