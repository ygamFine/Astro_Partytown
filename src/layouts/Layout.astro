---
import Header from "../components/Header.astro";
import FooterSection from "../components/FooterSection.astro";

export interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "å±±ä¸œæ°¸å®‰å»ºè®¾æœºæ¢°é›†å›¢æœ‰é™å…¬å¸ - ä¸“ä¸šå·¥ç¨‹æœºæ¢°åˆ¶é€ å•†",
} = Astro.props;
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEOä¼˜åŒ– -->
    <meta
      name="keywords"
      content="æ»‘ç§»è£…è½½æœº,å·¥ç¨‹æœºæ¢°,å»ºç­‘è®¾å¤‡,å±±ä¸œæ°¸å®‰,YONAN"
    />
    <meta name="author" content="å±±ä¸œæ°¸å®‰å»ºè®¾æœºæ¢°é›†å›¢æœ‰é™å…¬å¸" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />

    <!-- æ€§èƒ½ä¼˜åŒ– -->
    <meta name="theme-color" content="#e60012" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- ğŸš€ å…³é”®å›¾ç‰‡é¢„åŠ è½½ -->
    <link
      rel="preload"
      href="/images/mobile-banner-tiny.svg"
      as="image"
      media="(max-width: 768px)"
      fetchpriority="high"
    />

    <!-- ğŸš€ Partytowné…ç½® - åŸºç¡€é…ç½®ï¼Œè¯¦ç»†é…ç½®åœ¨ astro.config.mjs -->
    <script is:inline>
      // åŸºç¡€é…ç½®ä¼šè¢«astro.config.mjsä¸­çš„é…ç½®æ‰©å±•
      window.partytown = window.partytown || {};
    </script>

    <!-- DNSé¢„è¿æ¥ä¼˜åŒ– -->
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.google-analytics.com" />
    <link rel="preconnect" href="https://cdn.huazhi.cloud" />
    <link
      rel="preconnect"
      href="https://huazhicloud.oss-cn-beijing.aliyuncs.com"
    />

    <!-- ğŸš€ åæ™ºäº‘CSSå°†é€šè¿‡å®¢æˆ·ç«¯åŠ¨æ€åŠ è½½ -->

    <!-- ğŸš€ ç§»åŠ¨ç«¯å…³é”®CSSä¼˜åŒ– -->
    <style>
      /* åŸºç¡€é‡ç½® */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        line-height: 1.6;
        color: #333;
        background: #fff;
      }

      /* å…³é”®å†…å®¹æ ·å¼ */
      .text-4xl {
        font-size: 2.25rem;
        line-height: 2.5rem;
      }
      .font-bold {
        font-weight: 700;
      }
      .text-gray-800 {
        color: #1f2937;
      }
      .mb-4 {
        margin-bottom: 1rem;
      }
      .text-center {
        text-align: center;
      }
      .py-20 {
        padding-top: 5rem;
        padding-bottom: 5rem;
      }
      .bg-gray-50 {
        background-color: #f9fafb;
      }
      .container {
        max-width: 80rem;
        margin-left: auto;
        margin-right: auto;
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .mb-16 {
        margin-bottom: 4rem;
      }
      .text-xl {
        font-size: 1.25rem;
        line-height: 1.75rem;
      }
      .text-gray-600 {
        color: #4b5563;
      }
      .text-red-600 {
        color: #dc2626;
      }
      .text-lg {
        font-size: 1.125rem;
        line-height: 1.75rem;
      }
      .leading-relaxed {
        line-height: 1.625;
      }
      .leading-tight {
        line-height: 1.25;
      }

      /* å¸ƒå±€æ ·å¼ */
      .grid {
        display: grid;
      }
      .grid-cols-1 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      .gap-12 {
        gap: 3rem;
      }
      .items-center {
        align-items: center;
      }
      .space-y-8 > :not([hidden]) ~ :not([hidden]) {
        margin-top: 2rem;
      }

      @media (min-width: 1024px) {
        .lg\\:grid-cols-2 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        .lg\\:text-left {
          text-align: left;
        }
      }

      /* ç§»åŠ¨ç«¯å»¶è¿Ÿå†…å®¹ */
      @media (max-width: 768px) {
        .mobile-delayed-content {
          display: none !important;
        }

        .mobile-content-loaded .mobile-delayed-content {
          display: block !important;
        }

        .mobile-header-delayed {
          display: none !important;
        }

        .mobile-header-minimal {
          display: block !important;
        }

        .mobile-content-loaded .mobile-header-delayed {
          display: block !important;
        }

        .mobile-content-loaded .mobile-header-minimal {
          display: none !important;
        }

        .mobile-footer-delayed {
          display: none !important;
        }

        .mobile-content-loaded .mobile-footer-delayed {
          display: block !important;
        }

        /* ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ– */
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          transition-duration: 0.01ms !important;
        }

        img:not(.mobile-banner) {
          loading: lazy;
          decoding: async;
        }
      }

      @media (min-width: 769px) {
        .mobile-delayed-content,
        .mobile-header-delayed,
        .mobile-footer-delayed {
          display: block;
        }

        .mobile-header-minimal {
          display: none;
        }
      }

      /* Bannerä¼˜åŒ– */
      .mobile-banner-container {
        width: 100%;
        height: 200px;
        margin: 0;
        padding: 0;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .mobile-banner-instant-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        font-weight: bold;
      }

      .mobile-banner-instant-bg::after {
        content: "ä¸“ä¸šå·¥ç¨‹æœºæ¢°";
      }

      .mobile-banner-optimized {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 2;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .mobile-banner-optimized.loaded {
        opacity: 1;
      }

      /* ç„¦ç‚¹æ ·å¼ */
      .focus-visible-ring:focus-visible {
        outline: 2px solid #ef4444;
        outline-offset: 2px;
        border-radius: 0.25rem;
      }

      /* ğŸš€ åæ™ºäº‘å®¢æœç³»ç»ŸåŸºç¡€æ ·å¼ - ç¡®ä¿åœ¨ä¸»çº¿ç¨‹å¯ç”¨ */
      #hz_chat_app,
      #huazhi_chat_app {
        position: fixed !important;
        top: 0;
        right: 20px;
        bottom: 0;
        width: 376px;
        z-index: 199999;
        pointer-events: none;
        font-family: Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      #hz_chat_app .hz-launcher {
        position: absolute;
        bottom: 25px;
        right: 0;
        min-width: 48px;
        height: 48px;
        border-radius: 48px;
        cursor: pointer;
        pointer-events: auto;
        background: #428bca;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        box-shadow: 0 0 15px 0 rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
      }

      #hz_chat_app .hz-launcher:hover {
        background: #357abd;
        transform: scale(1.05);
      }

      #hz_chat_app .hz-wechat-main {
        pointer-events: auto;
        width: 376px;
        position: absolute;
        right: 0;
        height: 80%;
        bottom: 100px;
        max-height: 650px;
        border-radius: 8px 8px 0 0;
        overflow: hidden;
        opacity: 1;
        box-shadow: 0 0 15px 0 rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        background: #fff;
        transform: translateY(100%);
        transition: transform 0.3s ease;
      }

      #hz_chat_app .hz-wechat-main.show {
        transform: translateY(0);
      }

      /* ç§»åŠ¨ç«¯åæ™ºäº‘é€‚é… */
      @media (max-width: 768px) {
        #hz_chat_app {
          width: 100%;
          right: 0;
        }

        #hz_chat_app .hz-wechat-main {
          width: 100%;
          height: 100%;
          bottom: 0;
          max-height: 100vh;
          border-radius: 0;
        }

        #hz_chat_app .hz-launcher {
          bottom: 70px;
        }
      }
    </style>

    <title>{title}</title>
  </head>
  <body>

    <!-- ğŸš€ ç§»åŠ¨ç«¯å»¶è¿ŸHeader -->
    <div class="mobile-header-delayed">
      <Header />
    </div>

    <!-- ç§»åŠ¨ç«¯æç®€Header -->
    <div class="mobile-header-minimal">
      <header class="bg-white sticky top-0 z-50 shadow-sm">
        <div class="flex items-center justify-between h-16 px-4">
          <a href="/" class="flex items-center space-x-2">
            <span class="text-xl font-bold text-gray-800">æ°¸å®‰é‡å·¥</span>
          </a>
          <a
            href="/contact"
            class="bg-red-600 text-white px-4 py-2 rounded font-bold text-sm"
            >æŠ¥ä»·</a
          >
        </div>
      </header>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <main id="main-content">
      <slot />
    </main>

    <!-- ğŸš€ Partytownè®¾å¤‡æ£€æµ‹è„šæœ¬ -->
    <script is:inline>
      console.log("ğŸ” è®¾å¤‡æ£€æµ‹...");

      const isMobile =
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent,
        ) ||
        window.innerWidth <= 768 ||
        "ontouchstart" in window;

      console.log("ğŸ” è®¾å¤‡ç±»å‹:", isMobile ? "ğŸ“± ç§»åŠ¨ç«¯" : "ğŸ–¥ï¸ æ¡Œé¢ç«¯");
      console.log("âœ… æ‰€æœ‰ç¬¬ä¸‰æ–¹è„šæœ¬å°†é€šè¿‡Partytownåœ¨Web Workerä¸­è¿è¡Œ");
    </script>

    <!-- ğŸš€ Google Analytics - é€šè¿‡Partytownè¿è¡Œ -->
    <script type="text/partytown">
      // Google Analytics 4
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-71JP66YM5X");

      // åŠ è½½GAè„šæœ¬
      const gaScript = document.createElement("script");
      gaScript.async = true;
      gaScript.src = "https://www.googletagmanager.com/gtag/js?id=G-71JP66YM5X";
      document.head.appendChild(gaScript);

      console.log("ğŸ“Š Google Analytics å·²é€šè¿‡PartytownåŠ è½½");
    </script>

    <!-- ğŸš€ åæ™ºäº‘å®¢æœç³»ç»Ÿ - é€šè¿‡Partytownè¿è¡Œ -->
    <script>
      // åæ™ºäº‘å®¢æœç³»ç»Ÿ - ä¼˜åŒ–ç‰ˆæœ¬
      console.log("ğŸš€ å¼€å§‹åŠ è½½åæ™ºäº‘å®¢æœç³»ç»Ÿ...");
      
      // å»¶è¿ŸåŠ è½½åæ™ºäº‘å®¢æœ
      setTimeout(function() {
        try {
          const script = document.createElement("script");
          script.async = true;
          script.src = "https://huazhicloud.oss-cn-beijing.aliyuncs.com/hzchat/dist/livechat.js?v=" + Date.now();
          script.setAttribute('_extID', "1141-1153-lAj5UiTG");
          
          // æ·»åŠ é”™è¯¯å¤„ç†
          script.onerror = function() {
            console.warn("âš ï¸ åæ™ºäº‘å®¢æœè„šæœ¬åŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ");
          };
          
          script.onload = function() {
            console.log("âœ… åæ™ºäº‘å®¢æœç³»ç»ŸåŠ è½½æˆåŠŸ");
          };
          
          document.head.appendChild(script);
        } catch (error) {
          console.error("âŒ åæ™ºäº‘å®¢æœåŠ è½½é”™è¯¯:", error);
        }
      }, 3000);
    </script>

    <!-- ğŸš€ Speed Indexæç®€JavaScript -->
    <script>
      // ç§»åŠ¨ç«¯æç®€é€»è¾‘
      if (window.innerWidth <= 768) {
        // ç«‹å³æ˜¾ç¤ºBannerå›¾ç‰‡
        setTimeout(function () {
          const img = document.querySelector(".mobile-banner-optimized");
          if (img) img.classList.add("loaded");
        }, 100);

        // å»¶è¿ŸåŠ è½½å…¶ä»–å†…å®¹
        setTimeout(function () {
          document.body.classList.add("mobile-content-loaded");
        }, 3000);
      }
    </script>

    <!-- ğŸš€ ç§»åŠ¨ç«¯å»¶è¿ŸFooter -->
    <div class="mobile-footer-delayed">
      <FooterSection />
    </div>
  </body>
</html>

