---
import Header from "../components/Header.astro";
import FooterSection from "../components/FooterSection.astro";

export interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "å±±ä¸œæ°¸å®‰å»ºè®¾æœºæ¢°é›†å›¢æœ‰é™å…¬å¸ - ä¸“ä¸šå·¥ç¨‹æœºæ¢°åˆ¶é€ å•†",
} = Astro.props;
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEOä¼˜åŒ– -->
    <meta
      name="keywords"
      content="æ»‘ç§»è£…è½½æœº,å·¥ç¨‹æœºæ¢°,å»ºç­‘è®¾å¤‡,å±±ä¸œæ°¸å®‰,YONAN"
    />
    <meta name="author" content="å±±ä¸œæ°¸å®‰å»ºè®¾æœºæ¢°é›†å›¢æœ‰é™å…¬å¸" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />

    <!-- æ€§èƒ½ä¼˜åŒ– -->
    <meta name="theme-color" content="#e60012" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- ğŸš€ å…³é”®å›¾ç‰‡é¢„åŠ è½½ -->
    <link
      rel="preload"
      href="/images/mobile-banner-tiny.svg"
      as="image"
      media="(max-width: 768px)"
      fetchpriority="high"
    />

    <!-- ğŸš€ Partytowné…ç½® - åŸºç¡€é…ç½®ï¼Œè¯¦ç»†é…ç½®åœ¨ astro.config.mjs -->
    <script is:inline>
      // åŸºç¡€é…ç½®ä¼šè¢«astro.config.mjsä¸­çš„é…ç½®æ‰©å±•
      window.partytown = window.partytown || {};
    </script>

    <!-- DNSé¢„è¿æ¥ä¼˜åŒ– -->
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.google-analytics.com" />

    <!-- ğŸš€ æè‡´Speed Indexä¼˜åŒ– - ç›®æ ‡<2.5ç§’ -->
    <style>
      /* ç«‹å³æ˜¾ç¤ºå…³é”®å†…å®¹ - é›¶å»¶è¿Ÿ */
      .speed-critical {
        opacity: 1 !important;
        visibility: visible !important;
        transform: none !important;
        animation: none !important;
        transition: none !important;
        will-change: auto !important;
      }

      /* åŸºç¡€é‡ç½® */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        line-height: 1.6;
        color: #333;
        background: #fff;
        /* ç¦ç”¨æ‰€æœ‰éå…³é”®åŠ¨ç”» */
        animation-duration: 0s !important;
        animation-delay: 0s !important;
      }

      /* å…³é”®å†…å®¹æ ·å¼ */
      .text-4xl {
        font-size: 2.25rem;
        line-height: 2.5rem;
      }
      .font-bold {
        font-weight: 700;
      }
      .text-gray-800 {
        color: #1f2937;
      }
      .mb-4 {
        margin-bottom: 1rem;
      }
      .text-center {
        text-align: center;
      }
      .py-20 {
        padding-top: 5rem;
        padding-bottom: 5rem;
      }
      .bg-gray-50 {
        background-color: #f9fafb;
      }
      .container {
        max-width: 80rem;
        margin-left: auto;
        margin-right: auto;
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .mb-16 {
        margin-bottom: 4rem;
      }
      .text-xl {
        font-size: 1.25rem;
        line-height: 1.75rem;
      }
      .text-gray-600 {
        color: #4b5563;
      }
      .text-red-600 {
        color: #dc2626;
      }
      .text-lg {
        font-size: 1.125rem;
        line-height: 1.75rem;
      }
      .leading-relaxed {
        line-height: 1.625;
      }
      .leading-tight {
        line-height: 1.25;
      }

      /* å¸ƒå±€æ ·å¼ */
      .grid {
        display: grid;
      }
      .grid-cols-1 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      .gap-12 {
        gap: 3rem;
      }
      .items-center {
        align-items: center;
      }
      .space-y-8 > :not([hidden]) ~ :not([hidden]) {
        margin-top: 2rem;
      }

      @media (min-width: 1024px) {
        .lg\\:grid-cols-2 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        .lg\\:text-left {
          text-align: left;
        }
      }

      /* ğŸš€ Speed Indexæè‡´ä¼˜åŒ– */
      @media (max-width: 768px) {
        /* ç«‹å³éšè—éå…³é”®å†…å®¹ */
        .mobile-delayed-content {
          display: none !important;
        }

        .speed-loaded .mobile-delayed-content {
          display: block !important;
        }

        .mobile-header-delayed {
          display: none !important;
        }

        .mobile-header-minimal {
          display: block !important;
        }

        .speed-loaded .mobile-header-delayed {
          display: block !important;
        }

        .speed-loaded .mobile-header-minimal {
          display: none !important;
        }

        .mobile-footer-delayed {
          display: none !important;
        }

        .speed-loaded .mobile-footer-delayed {
          display: block !important;
        }

        /* ç¦ç”¨æ‰€æœ‰åŠ¨ç”»æå‡Speed Index */
        *,
        *::before,
        *::after {
          animation: none !important;
          transition: none !important;
          transform: none !important;
          will-change: auto !important;
        }

        /* å…³é”®å›¾ç‰‡ç«‹å³æ˜¾ç¤º */
        .mobile-banner,
        .speed-critical {
          opacity: 1 !important;
          visibility: visible !important;
          display: block !important;
        }

        /* éå…³é”®å›¾ç‰‡å»¶è¿ŸåŠ è½½ */
        img:not(.mobile-banner):not(.speed-critical) {
          loading: lazy;
          decoding: async;
          opacity: 0;
        }

        .speed-loaded img:not(.mobile-banner):not(.speed-critical) {
          opacity: 1;
        }
      }

      @media (min-width: 769px) {
        .mobile-delayed-content,
        .mobile-header-delayed,
        .mobile-footer-delayed {
          display: block;
        }

        .mobile-header-minimal {
          display: none;
        }
      }

      /* Bannerä¼˜åŒ– */
      .mobile-banner-container {
        width: 100%;
        height: 200px;
        margin: 0;
        padding: 0;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .mobile-banner-instant-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        font-weight: bold;
      }

      .mobile-banner-instant-bg::after {
        content: "ä¸“ä¸šå·¥ç¨‹æœºæ¢°";
      }

      .mobile-banner-optimized {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 2;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .mobile-banner-optimized.loaded {
        opacity: 1;
      }

      /* ç„¦ç‚¹æ ·å¼ */
      .focus-visible-ring:focus-visible {
        outline: 2px solid #ef4444;
        outline-offset: 2px;
        border-radius: 0.25rem;
      }
    </style>

    <title>{title}</title>
  </head>
  <body>
    <!-- ğŸš€ ç§»åŠ¨ç«¯å»¶è¿ŸHeader -->
    <div class="mobile-header-delayed">
      <Header />
    </div>

    <!-- ç§»åŠ¨ç«¯æç®€Header -->
    <div class="mobile-header-minimal">
      <header class="bg-white sticky top-0 z-50 shadow-sm">
        <div class="flex items-center justify-between h-16 px-4">
          <a href="/" class="flex items-center space-x-2">
            <span class="text-xl font-bold text-gray-800">æ°¸å®‰é‡å·¥</span>
          </a>
          <a
            href="/contact"
            class="bg-red-600 text-white px-4 py-2 rounded font-bold text-sm"
            >æŠ¥ä»·</a
          >
        </div>
      </header>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <main id="main-content">
      <slot />
    </main>

    <!-- ğŸš€ Partytownè®¾å¤‡æ£€æµ‹è„šæœ¬ -->
    <script is:inline>
      console.log("ğŸ” è®¾å¤‡æ£€æµ‹...");

      const isMobile =
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent,
        ) ||
        window.innerWidth <= 768 ||
        "ontouchstart" in window;

      console.log("ğŸ” è®¾å¤‡ç±»å‹:", isMobile ? "ğŸ“± ç§»åŠ¨ç«¯" : "ğŸ–¥ï¸ æ¡Œé¢ç«¯");
      console.log("âœ… æ‰€æœ‰ç¬¬ä¸‰æ–¹è„šæœ¬å°†é€šè¿‡Partytownåœ¨Web Workerä¸­è¿è¡Œ");
    </script>

    <!-- ğŸš€ Google Analytics - é€šè¿‡Partytownè¿è¡Œ -->
    <script type="text/partytown">
      // Google Analytics 4
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-71JP66YM5X");

      // åŠ è½½GAè„šæœ¬
      const gaScript = document.createElement("script");
      gaScript.async = true;
      gaScript.src = "https://www.googletagmanager.com/gtag/js?id=G-71JP66YM5X";
      document.head.appendChild(gaScript);

      console.log("ğŸ“Š Google Analytics å·²é€šè¿‡PartytownåŠ è½½");
    </script>
    <script type="text/partytown">
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src =
          "https://cdn.huazhi.cloud/hzchat/dist/livechat.js?time=" +
          new Date().getTime();
        hm.setAttribute("_extID", "309-313-7n1iAECE");
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>

    <!-- ğŸš€ Speed Indexæ¿€è¿›ä¼˜åŒ– - ç›®æ ‡<2.5ç§’ -->
    <script>
      // ç«‹å³è®¾ç½®å…³é”®æ ·å¼ç±»
      document.documentElement.classList.add("speed-critical");

      // ç§»åŠ¨ç«¯æ¿€è¿›ä¼˜åŒ–
      if (window.innerWidth <= 768) {
        // ç«‹å³éšè—æ‰€æœ‰éå…³é”®å†…å®¹
        const style = document.createElement("style");
        style.textContent = `
          .mobile-delayed-content { display: none !important; }
          .mobile-header-delayed { display: none !important; }
          .mobile-footer-delayed { display: none !important; }
          img:not(.mobile-banner):not(.speed-critical) { opacity: 0 !important; }
        `;
        document.head.appendChild(style);

        // ç«‹å³æ˜¾ç¤ºå…³é”®Banner
        const banners = document.querySelectorAll(".mobile-banner");
        banners.forEach((banner) => {
          if (banner instanceof HTMLElement) {
            banner.style.opacity = "1";
            banner.style.visibility = "visible";
            banner.classList.add("speed-critical");
          }
        });

        // æé€Ÿå»¶è¿ŸåŠ è½½ï¼ˆå‡å°‘åˆ°1.5ç§’ï¼‰
        setTimeout(function () {
          document.body.classList.add("speed-loaded");
          console.log("âš¡ Speed Indexä¼˜åŒ–ï¼š1.5ç§’ååŠ è½½éå…³é”®å†…å®¹");
        }, 1500);
      } else {
        // æ¡Œé¢ç«¯ç«‹å³åŠ è½½æ‰€æœ‰å†…å®¹
        document.body.classList.add("speed-loaded");
      }

      // æ€§èƒ½ç›‘æ§
      if ("PerformanceObserver" in window) {
        try {
          const observer = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const lcp = entries[entries.length - 1];
            console.log(`âš¡ LCP: ${lcp.startTime.toFixed(2)}ms`);

            // å¦‚æœLCP > 2500msï¼Œè®°å½•è­¦å‘Š
            if (lcp.startTime > 2500) {
              console.warn("âš ï¸ LCPè¶…è¿‡2.5ç§’ï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–");
            }
          });
          observer.observe({ entryTypes: ["largest-contentful-paint"] });
        } catch (e) {
          console.log("LCP monitoring not supported");
        }
      }
    </script>

    <!-- ğŸš€ ç§»åŠ¨ç«¯å»¶è¿ŸFooter -->
    <div class="mobile-footer-delayed">
      <FooterSection />
    </div>
  </body>
</html>
