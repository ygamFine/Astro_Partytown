---
import Header from "../components/common/layout/Header.astro";
import FooterSection from "../components/common/layout/FooterSection.astro";
import DynamicScriptLoader from "../components/common/analytics/DynamicScriptLoader.astro";
import PagefindPreloader from "../components/common/analytics/PagefindPreloader.astro";
import AnimationSystem from "../components/common/AnimationSystem.astro";
import RightSidebar from "../components/common/RightSidebar.astro";
import ContactModal from "../components/common/contact/ContactModal.astro";

export interface Props {
  title: string;
  description?: string;
  lang?: string;
  pageType?: string;
}

const {
  title,
  description = "å±±ä¸œæ°¸å®‰å»ºè®¾æœºæ¢°é›†å›¢æœ‰é™å…¬å¸ - ä¸“ä¸šå·¥ç¨‹æœºæ¢°åˆ¶é€ å•†",
  lang = "en",
  pageType = "home",
} = Astro.props;

// é¡µé¢å®½åº¦é…ç½® - ç”±å„é¡µé¢ç»„ä»¶è‡ªè¡Œç®¡ç†
// æ¯ä¸ªé¡µé¢ç»„ä»¶åº”åœ¨å…¶è‡ªå·±çš„æ–‡ä»¶ä¸­å®šä¹‰ pageWidth

// RTL è¯­è¨€åˆ—è¡¨
const RTL_LANGUAGES = ['ar'];
const isRTL = RTL_LANGUAGES.includes(lang);
const htmlDir = isRTL ? 'rtl' : 'ltr';
---

<!doctype html>
<html lang={lang} dir={htmlDir}>
  <head>
    
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- å­—ä½“é¢„åŠ è½½å’Œä¼˜åŒ– -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- é˜¿æ‹‰ä¼¯è¯­å­—ä½“é¢„åŠ è½½ -->
    {isRTL && (
      <>
        <link 
          rel="preload" 
          href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" 
          as="style" 
          onload="this.onload=null;this.rel='stylesheet'"
        />
        <noscript>
          <link 
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" 
            rel="stylesheet"
          />
        </noscript>
      </>
    )}
    
    <!-- å…³é”®å›¾ç‰‡é¢„åŠ è½½ - æŒ‰ä¼˜å…ˆçº§æ’åº -->
    <link rel="preload" href="/images/logo.png.webp" as="image" fetchpriority="high" />
    <link rel="preload" href="/images/banner3.webp" as="image" fetchpriority="high" />
    <link rel="preload" href="/images/banner.webp" as="image" fetchpriority="high" />
    <link rel="preload" href="/images/shouji-banner1-ultra.webp" as="image" fetchpriority="high" media="(max-width: 768px)" />
    <link rel="preload" href="/images/skid1-400.webp" as="image" fetchpriority="low" />
    <link rel="preload" href="/images/backhoe-400.webp" as="image" fetchpriority="low" />
    
    <!-- DNSé¢„è§£æ -->
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />
    <link rel="dns-prefetch" href="//cdn.huazhi.cloud" />
    
    <!-- SEOä¼˜åŒ– -->
    <meta
      name="keywords"
      content="æ»‘ç§»è£…è½½æœº,å·¥ç¨‹æœºæ¢°,å»ºç­‘è®¾å¤‡,å±±ä¸œæ°¸å®‰,YONAN"
    />
    <meta name="author" content="å±±ä¸œæ°¸å®‰å»ºè®¾æœºæ¢°é›†å›¢æœ‰é™å…¬å¸" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />

    <!-- ğŸ¯ ä¼˜åŒ–çš„ GTM åŠ è½½å™¨ - æ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒ -->
    <!-- <GTMLoader /> -->

    <!-- ğŸ¯ Header ä½ç½®åŠ¨æ€è„šæœ¬åŠ è½½å™¨ - æ’å…¥åˆ° <head> æ ‡ç­¾å†… -->
    <DynamicScriptLoader 
      position="header" 
      pageType={pageType}
      lang={lang}
    />

    <!-- å…¨å±€æ ·å¼å·²å†…è”åˆ°ä¸‹æ–¹ -->

    <!-- å†…è”å…³é”®CSS - é˜²æ­¢æ¸²æŸ“é˜»å¡ -->
    <style>
      /* å…¨å±€é‡ç½®å’ŒåŸºç¡€æ ·å¼ - å…³é”®è·¯å¾„ */
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      html {
        scroll-behavior: smooth;
        font-size: 10px;
        overflow-x: hidden;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        font-display: swap;
        line-height: 1.6;
        color: #333;
        background: #fff;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeSpeed;
        overflow-x: hidden;
        width: 100%;
        max-width: 100vw;
      }

      /* RTL è¯­è¨€æ ·å¼ */
      [dir="rtl"] {
        text-align: right;
      }

      [dir="rtl"] body {
        font-family: "Noto Sans Arabic", "Arial Unicode MS", "Tahoma", Arial, sans-serif;
        direction: rtl;
      }

      /* RTL å¸ƒå±€è°ƒæ•´ */
      [dir="rtl"] .container {
        direction: rtl;
      }

      [dir="rtl"] .text-left {
        text-align: right !important;
      }

      [dir="rtl"] .text-right {
        text-align: left !important;
      }

      [dir="rtl"] .ml-auto {
        margin-left: 0 !important;
        margin-right: auto !important;
      }

      [dir="rtl"] .mr-auto {
        margin-right: 0 !important;
        margin-left: auto !important;
      }

      /* RTL Flexbox è°ƒæ•´ */
      [dir="rtl"] .flex-row {
        flex-direction: row-reverse;
      }

      [dir="rtl"] .justify-start {
        justify-content: flex-end;
      }

      [dir="rtl"] .justify-end {
        justify-content: flex-start;
      }

      /* RTL Grid è°ƒæ•´ */
      [dir="rtl"] .grid {
        direction: rtl;
      }

      [dir="rtl"] .grid > * {
        direction: ltr;
      }

      /* RTL è¾¹è·å’Œå¡«å……è°ƒæ•´ */
      [dir="rtl"] .pl-2 { padding-left: 0; padding-right: 0.5rem; }
      [dir="rtl"] .pr-2 { padding-right: 0; padding-left: 0.5rem; }
      [dir="rtl"] .pl-3 { padding-left: 0; padding-right: 0.75rem; }
      [dir="rtl"] .pr-3 { padding-right: 0; padding-left: 0.75rem; }
      [dir="rtl"] .pl-4 { padding-left: 0; padding-right: 1rem; }
      [dir="rtl"] .pr-4 { padding-right: 0; padding-left: 1rem; }
      [dir="rtl"] .pl-6 { padding-left: 0; padding-right: 1.5rem; }
      [dir="rtl"] .pr-6 { padding-right: 0; padding-left: 1.5rem; }
      [dir="rtl"] .pl-8 { padding-left: 0; padding-right: 2rem; }
      [dir="rtl"] .pr-8 { padding-right: 0; padding-left: 2rem; }

      [dir="rtl"] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
      [dir="rtl"] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
      [dir="rtl"] .ml-3 { margin-left: 0; margin-right: 0.75rem; }
      [dir="rtl"] .mr-3 { margin-right: 0; margin-left: 0.75rem; }
      [dir="rtl"] .ml-4 { margin-left: 0; margin-right: 1rem; }
      [dir="rtl"] .mr-4 { margin-right: 0; margin-left: 1rem; }
      [dir="rtl"] .ml-6 { margin-left: 0; margin-right: 1.5rem; }
      [dir="rtl"] .mr-6 { margin-right: 0; margin-left: 1.5rem; }

      /* RTL è¾¹æ¡†è°ƒæ•´ */
      [dir="rtl"] .border-l { border-left: 0; border-right: 1px solid; }
      [dir="rtl"] .border-r { border-right: 0; border-left: 1px solid; }

      /* RTL åœ†è§’è°ƒæ•´ */
      [dir="rtl"] .rounded-l { border-radius: 0 0.5rem 0.5rem 0; }
      [dir="rtl"] .rounded-r { border-radius: 0.5rem 0 0 0.5rem; }
      [dir="rtl"] .rounded-tl { border-top-left-radius: 0; border-top-right-radius: 0.5rem; }
      [dir="rtl"] .rounded-tr { border-top-right-radius: 0; border-top-left-radius: 0.5rem; }
      [dir="rtl"] .rounded-bl { border-bottom-left-radius: 0; border-bottom-right-radius: 0.5rem; }
      [dir="rtl"] .rounded-br { border-bottom-right-radius: 0; border-bottom-left-radius: 0.5rem; }

      /* RTL æµ®åŠ¨è°ƒæ•´ */
      [dir="rtl"] .float-left { float: right; }
      [dir="rtl"] .float-right { float: left; }

      /* RTL Transform è°ƒæ•´ */
      [dir="rtl"] .transform {
        transform: scaleX(-1);
      }

      [dir="rtl"] .transform svg {
        transform: scaleX(-1);
      }

      /* é˜¿æ‹‰ä¼¯è¯­å­—ä½“ä¼˜åŒ– */
      [dir="rtl"] {
        font-feature-settings: "liga" 1, "kern" 1;
        font-variant-ligatures: common-ligatures;
        text-rendering: optimizeLegibility;
      }
      
      /* æ ¸å¿ƒå¸ƒå±€ - é¦–å±å¿…éœ€ */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
        width: 100%;
        box-sizing: border-box;
      }
      
      /* ä¸»å†…å®¹åŒºåŸŸé˜²æ­¢æº¢å‡º */
      main {
        width: 100%;
        overflow-x: hidden;
        position: relative;
      }
      
      /* æ‰€æœ‰sectioné˜²æ­¢æº¢å‡º */
      section {
        width: 100%;
        overflow-x: hidden;
        position: relative;
        box-sizing: border-box;
      }
      
      /* é˜²æ­¢CLSçš„å›ºå®šå°ºå¯¸ */
      @media (max-width: 768px) {
        .mobile-banner-container {
          height: 200px;
          contain: layout;
        }
        
        /* ç§»åŠ¨ç«¯é¢å¤–é˜²æŠ¤ */
        body, html {
          position: relative;
        }
        
        * {
          box-sizing: border-box;
        }
        
        section, div, main, .container {
          max-width: 100vw;
          overflow-x: hidden;
        }
      }

      /* Headerå›ºå®šé«˜åº¦ - é˜²æ­¢CLS */
      header {
        height: 80px;
        contain: layout;
      }

      @media (max-width: 768px) {
        header {
          height: 60px;
        }
      }

      /* å›¾ç‰‡åŠ è½½ä¼˜åŒ– */
      img {
        max-width: 100%;
        height: auto;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
      }

      /* æ€§èƒ½ä¼˜åŒ–çš„æŒ‰é’® */
      .btn-primary {
        background: #dc2626;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 700;
        text-decoration: none;
        display: inline-block;
        will-change: transform;
        transition: transform 0.2s ease;
      }
      
      .btn-primary:hover {
        transform: translateY(-1px);
      }
      
      .btn-secondary {
        background: #e5e7eb;
        color: #1f2937;
        padding: 0.75rem 2rem;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 1.125rem;
        text-decoration: none;
        display: inline-block;
        will-change: transform;
        transition: transform 0.2s ease;
      }

      .btn-secondary:hover {
        transform: translateY(-1px);
      }

      /* å…³é”®åŠ¨ç”»ä¼˜åŒ– */
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* è°ƒæ•´ç§»åŠ¨ç«¯ banner ä¸äº§å“é¡ºåº - é˜²æ­¢CLS */
      @media (max-width: 767px) {
        #main-content {
          display: flex;
          flex-direction: column;
        }
        #main-content > section.hero-mobile {
          order: -1 !important;
          contain: layout;
        }
        #main-content > section.product-showcase {
          order: 0 !important;
          contain: layout;
        }
      }

      /* æ‡’åŠ è½½å›¾ç‰‡ä¼˜åŒ– */
      img[loading="lazy"] {
        transition: opacity 0.3s ease;
      }

      img[loading="lazy"]:not([src]) {
        opacity: 0;
      }

      /* è§¦æ‘¸ä¼˜åŒ– */
      .touch-target {
        touch-action: manipulation;
        min-height: 44px;
        min-width: 44px;
      }

      /* éª¨æ¶å±æ ·å¼ */
      .skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }

      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }

      /* å†…è”å­—ä½“æ ·å¼ - ä¼˜åŒ–æ€§èƒ½ */
      @font-face {
        font-family: 'System-UI';
        src: local('system-ui'), local('-apple-system'), local('BlinkMacSystemFont');
        font-display: swap;
      }

      /* ç®€å•çš„åŠ¨ç”»ç³»ç»Ÿ */
      .animate-fade-up {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      }

      .animate-fade-up.animate-in {
        opacity: 1;
        transform: translateY(0);
      }

      .animate-fade-left {
        opacity: 0;
        transform: translateX(-30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      }

      .animate-fade-left.animate-in {
        opacity: 1;
        transform: translateX(0);
      }

      .animate-fade-right {
        opacity: 0;
        transform: translateX(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      }

      .animate-fade-right.animate-in {
        opacity: 1;
        transform: translateX(0);
      }

      .animate-scale-up {
        opacity: 0;
        transform: scale(0.9);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      }

      .animate-scale-up.animate-in {
        opacity: 1;
        transform: scale(1);
      }

      /* å»¶è¿ŸåŠ¨ç”» */
      .animate-delay-100 { transition-delay: 0.1s; }
      .animate-delay-200 { transition-delay: 0.2s; }
      .animate-delay-300 { transition-delay: 0.3s; }
      .animate-delay-400 { transition-delay: 0.4s; }
      .animate-delay-500 { transition-delay: 0.5s; }
      .animate-delay-600 { transition-delay: 0.6s; }
      .animate-delay-700 { transition-delay: 0.7s; }
      .animate-delay-800 { transition-delay: 0.8s; }
      .animate-delay-900 { transition-delay: 0.9s; }

      /* å¡ç‰‡æ‚¬åœåŠ¨ç”» */
      .card-hover-animate {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card-hover-animate:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }

      /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
      .btn-hover-animate {
        transition: transform 0.3s ease;
      }

      .btn-hover-animate:hover {
        transform: translateY(-2px);
      }

      /* æ•°å­—è®¡æ•°å™¨ */
      .counter-number {
        font-variant-numeric: tabular-nums;
      }
    </style>

    <title>{title}</title>
  </head>
  <body data-pagefind-body>
    <!-- ğŸ¯ Body Top ä½ç½®åŠ¨æ€è„šæœ¬åŠ è½½å™¨ - æ’å…¥åˆ° <body> æ ‡ç­¾å¼€å§‹å¤„ -->
    <DynamicScriptLoader 
      position="body-top" 
      pageType={pageType}
      lang={lang}
    />

    <Header />
    
    <main id="main-content">
      <slot />
    </main>

    <!-- å…¨å±€å³ä¾§ä¾§è¾¹æ  -->
    <RightSidebar lang={lang} data-pagefind-ignore />

    <!-- è”ç³»è¡¨å•æ¨¡æ€ -->
    <ContactModal translations={{ common: {} }} data-pagefind-ignore />


    <!-- ğŸš€ ç¬¬ä¸‰æ–¹è„šæœ¬é¢„ç•™ä½ç½® -->
    <!-- å¦‚éœ€æ·»åŠ ç¬¬ä¸‰æ–¹è„šæœ¬ï¼ˆå¦‚å®¢æœç³»ç»Ÿï¼‰ï¼Œè¯·åœ¨æ­¤å¤„æ·»åŠ  -->

    <!-- ğŸš€ Pagefind é¢„åŠ è½½å™¨ - ä½¿ç”¨ä¸“ç”¨ç»„ä»¶ -->
    <PagefindPreloader 
      pageType={pageType}
      lang={lang}
      currentPath={Astro.url.pathname}
      preloadStrategy="smart"
      enableDebug={import.meta.env.DEV}
    />

    <!-- ğŸ›¡ï¸ å…¨å±€é”™è¯¯å¤„ç† - æŒ‰éœ€åŠ è½½ç‰ˆæœ¬ -->
    <!-- <script is:inline>
      // å…¨å±€é”™è¯¯å¤„ç†ç³»ç»Ÿ - ä»…åœ¨éœ€è¦æ—¶å¯ç”¨
      (function() {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦é”™è¯¯å¤„ç†
        const needsErrorHandling = () => {
          // æ£€æŸ¥æ˜¯å¦æœ‰ç¬¬ä¸‰æ–¹è„šæœ¬éœ€è¦ä¿®å¤
          const hasThirdPartyScripts = document.querySelectorAll('script[src*="huazhi.cloud"], script[src*="livechat"]').length > 0;
          return hasThirdPartyScripts;
        };

        // ä»…åœ¨éœ€è¦æ—¶å¯ç”¨é”™è¯¯å¤„ç†
        if (needsErrorHandling()) {
          // ä¿®å¤ className.indexOf é”™è¯¯
          const originalIndexOf = String.prototype.indexOf;
          String.prototype.indexOf = function(searchValue, fromIndex) {
            if (this === null || this === undefined) {
              return -1;
            }
            return originalIndexOf.call(this, searchValue, fromIndex);
          };
          
          // ä¿®å¤ Element.prototype.className çš„é—®é¢˜
          const originalClassName = Object.getOwnPropertyDescriptor(Element.prototype, 'className');
          if (originalClassName) {
            Object.defineProperty(Element.prototype, 'className', {
              get: function() {
                return this.getAttribute('class') || '';
              },
              set: function(value) {
                this.setAttribute('class', value || '');
              }
            });
          }
          
          // å…¨å±€é”™è¯¯æ•è·
          window.addEventListener('error', function(event) {
            if (event.error && event.error.message && event.error.message.includes('className.indexOf')) {
              event.preventDefault();
              console.warn('å·²ä¿®å¤ className.indexOf é”™è¯¯');
              return false;
            }
          });

          if (import.meta.env.DEV) {
            console.log('ğŸ›¡ï¸ å…¨å±€é”™è¯¯å¤„ç†å·²å¯ç”¨');
          }
        }
      })();
    </script> -->

    <!-- ğŸ¬ åŠ¨ç”»ç³»ç»Ÿ - ä½¿ç”¨ä¸“ç”¨ç»„ä»¶ -->
    <AnimationSystem 
      enableAnimations={true}
      enableCounters={true}
      animationStrategy="smart"
      enableDebug={import.meta.env.DEV}
    />

    <!-- è§†å›¾åˆ‡æ¢åŠŸèƒ½ -->
    <script type="text/partytown" src="/scripts/viewToggle.js"></script>

    <FooterSection />
    <!-- ğŸ¯ Body Bottom ä½ç½®åŠ¨æ€è„šæœ¬åŠ è½½å™¨ - æ’å…¥åˆ° <body> æ ‡ç­¾ç»“æŸå‰ -->
    <DynamicScriptLoader 
      position="body-bottom" 
      pageType={pageType}
      lang={lang}
    />
  </body>
</html>
