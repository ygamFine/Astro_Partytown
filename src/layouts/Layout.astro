---
import Header from "../components/Header.astro";
import FooterSection from "../components/FooterSection.astro";

export interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "山东永安建设机械集团有限公司 - 专业工程机械制造商",
} = Astro.props;
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- 字体预加载和优化 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- 关键图片预加载 - 按优先级排序 -->
    <link rel="preload" href="/images/shouji-banner1-ultra.webp?v=3" as="image" fetchpriority="high" media="(max-width: 768px)" />
    <link rel="preload" href="/images/optimized/banner3-optimized.webp?v=1" as="image" fetchpriority="high" media="(min-width: 769px)" />
    <link rel="preload" href="/main-product.svg" as="image" fetchpriority="high" media="(min-width: 769px)" />
    <link rel="preload" href="/images/skid1-400.webp" as="image" fetchpriority="low" />
    <link rel="preload" href="/backhoe.webp" as="image" fetchpriority="low" />
    
    <!-- DNS预解析 -->
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />
    <link rel="dns-prefetch" href="//cdn.huazhi.cloud" />
    
    <!-- SEO优化 -->
    <meta
      name="keywords"
      content="滑移装载机,工程机械,建筑设备,山东永安,YONAN"
    />
    <meta name="author" content="山东永安建设机械集团有限公司" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />

    <!-- 内联关键CSS - 防止渲染阻塞 -->
    <style>
      /* 全局重置和基础样式 - 关键路径 */
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      html {
        scroll-behavior: smooth;
        font-size: 10px;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        font-display: swap;
        line-height: 1.6;
        color: #333;
        background: #fff;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeSpeed;
      }
      
      /* 核心布局 - 首屏必需 */
      .container {
        max-width: 80rem;
        margin: 0 auto;
        padding: 0 1rem;
      }
      
      /* 防止CLS的固定尺寸 */
      @media (max-width: 768px) {
        .mobile-banner-container {
          height: 200px;
          contain: layout;
        }
      }

      /* Header固定高度 - 防止CLS */
      header {
        height: 80px;
        contain: layout;
      }

      @media (max-width: 768px) {
        header {
          height: 60px;
        }
      }

      /* 图片加载优化 */
      img {
        max-width: 100%;
        height: auto;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
      }

      /* 性能优化的按钮 */
      .btn-primary {
        background: #dc2626;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 700;
        text-decoration: none;
        display: inline-block;
        will-change: transform;
        transition: transform 0.2s ease;
      }
      
      .btn-primary:hover {
        transform: translateY(-1px);
      }
      
      .btn-secondary {
        background: #e5e7eb;
        color: #1f2937;
        padding: 0.75rem 2rem;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 1.125rem;
        text-decoration: none;
        display: inline-block;
        will-change: transform;
        transition: transform 0.2s ease;
      }

      .btn-secondary:hover {
        transform: translateY(-1px);
      }

      /* 关键动画优化 */
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* 调整移动端 banner 与产品顺序 - 防止CLS */
      @media (max-width: 767px) {
        #main-content {
          display: flex;
          flex-direction: column;
        }
        #main-content > section.hero-mobile {
          order: -1 !important;
          contain: layout;
        }
        #main-content > section.product-showcase {
          order: 0 !important;
          contain: layout;
        }
      }

      /* 懒加载图片优化 */
      img[loading="lazy"] {
        transition: opacity 0.3s ease;
      }

      img[loading="lazy"]:not([src]) {
        opacity: 0;
      }

      /* 触摸优化 */
      .touch-target {
        touch-action: manipulation;
        min-height: 44px;
        min-width: 44px;
      }

      /* 骨架屏样式 */
      .skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }

      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }

      /* 内联字体样式 - 优化性能 */
      @font-face {
        font-family: 'System-UI';
        src: local('system-ui'), local('-apple-system'), local('BlinkMacSystemFont');
        font-display: swap;
      }
    </style>

    <title>{title}</title>
  </head>
  <body>
    <Header />
    
    <main id="main-content">
      <slot />
    </main>

    <!-- 使用Partytown将Analytics移到Web Worker - 减少主线程阻塞 -->
    <script async type="text/partytown" src="https://www.googletagmanager.com/gtag/js?id=G-71JP66YM5X"></script>
    <script type="text/partytown">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-71JP66YM5X', {
        page_title: document.title,
        page_location: window.location.href
      });
    </script>

    <!-- 大幅延迟客服脚本加载 -->
    <script> 
      window.addEventListener('load', () => {
        setTimeout(() => {
          const hm = document.createElement("script");
          hm.src = "https://cdn.huazhi.cloud/hzchat/dist/livechat.js?time="+new Date().getTime();
          hm.setAttribute('_extID',"309-313-7n1iAECE");
          document.head.appendChild(hm);
        }, 10000); // 10秒后再加载客服
      });
    </script>

    <FooterSection />
  </body>
</html>
