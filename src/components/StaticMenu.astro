---
// SSGé™æ€èœå•ç»„ä»¶ - æ„å»ºæ—¶è·å–èœå•æ•°æ®
import { getMenus } from '../lib/strapi.js';

// è·å–å½“å‰é¡µé¢è·¯å¾„ï¼Œç”¨äºæœåŠ¡ç«¯æ¸²æŸ“æ—¶è®¾ç½®é€‰ä¸­çŠ¶æ€
const currentPath = Astro.url.pathname;

// åœ¨æ„å»ºæ—¶è·å–èœå•æ•°æ®
interface MenuItem {
  name: string;
  path: string;
  children?: MenuItem[];
}

let menuItems: MenuItem[] = [];
try {
  menuItems = await getMenus();
} catch (error) {
  // æŒ‰åŸå‹å›¾çš„è‹±æ–‡èœå•ï¼ŒåŒ…å«ä¸‹æ‹‰å­èœå•
  menuItems = [
    { name: 'Home', path: '/' },
    { name: 'About', path: '/about' },
    { 
      name: 'Products', 
      path: '/products',
      children: [
        { name: 'All Products', path: '/products' },
        { name: 'Skid Steer Loader', path: '/products?category=æ»‘ç§»è£…è½½æœº' },
        { name: 'Backhoe Loader', path: '/products?category=æŒ–æ˜è£…è½½æœº' },
        { name: 'Telescopic Handler', path: '/products?category=ä¼¸ç¼©è‡‚å‰è£…è½¦' },
        { name: 'Electric Machinery', path: '/products?category=ç”µåŠ¨å·¥ç¨‹æœºæ¢°' },
        { name: 'Electric Machinery', path: '/products?category=ç”µåŠ¨å·¥ç¨‹æœºæ¢°' }
      ]
    },
    { name: 'Case', path: '/case' },
    { name: 'News', path: '/news' },
    { name: 'Contact', path: '/contact' }
  ];
}
---

<!-- æ¡Œé¢ç«¯èœå• - å®Œæ•´çš„å¯¼èˆªæ å¸ƒå±€ -->
<div class="w-full flex items-center justify-between h-full">
  <!-- å·¦ä¾§ä¸»å¯¼èˆªèœå• -->
  <nav class="flex items-center" aria-label="ä¸»è¦å¯¼èˆª">
    {menuItems.map((item, index) => (
      <div class="relative dropdown-container">
    <a 
      href={item.path} 
          class={`menu-item text-white font-semibold text-center py-4 ${
            (currentPath === item.path) || (currentPath === '/' && item.path === '/') ? 'active' : ''
          } ${item.children ? 'has-dropdown' : ''}`}
          style="font-size: 2rem; width: 15rem; display: flex; align-items: center; justify-content: center;"
          data-path={item.path}
          data-index={index}
    >
      {item.name}
          {item.children && (
            <svg class="w-4 h-4 ml-2 dropdown-arrow transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          )}
        </a>
        
        {item.children && (
          <div class="dropdown-menu absolute top-full left-0 bg-white shadow-lg border border-gray-200 rounded-md overflow-hidden z-50 hidden" style="min-width: 32rem;">
            <div class="dropdown-header bg-gradient-to-r from-red-50 to-red-100 px-6 py-3 border-b border-red-200">
              <h3 class="text-red-700 font-semibold text-lg">Product Categories</h3>
              <p class="text-red-600 text-sm mt-1">Choose from our comprehensive range</p>
            </div>
            {item.children.map((child, index) => (
              <a 
                href={child.path} 
                class={`product-menu-item flex items-center px-6 py-4 text-gray-800 hover:bg-red-50 hover:text-red-600 transition-all duration-200 border-b border-gray-100 last:border-b-0 ${index === 0 ? 'featured-item' : ''}`}
                style="font-size: 1.5rem;"
              >
                <div class="menu-icon w-8 h-8 mr-4 flex items-center justify-center rounded-full bg-gray-100 text-gray-600">
                  {index === 0 ? (
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                  ) : index === 1 ? (
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
                      <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"/>
                    </svg>
                  ) : index === 2 ? (
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 2L3 7v11a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h4a1 1 0 001-1V7l-7-5z" clip-rule="evenodd"/>
                    </svg>
                  ) : index === 3 ? (
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                    </svg>
                  ) : index === 4 ? (
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  ) : (
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                    </svg>
                  )}
                </div>
                <div class="flex-1">
                  <div class="font-medium">{child.name}</div>
                  <div class="text-xs text-gray-500 mt-1">
                    {index === 0 ? 'Browse all available products' : 
                     index === 1 ? 'Compact & versatile loaders' :
                     index === 2 ? 'Excavation & loading combo' :
                     index === 3 ? 'Extended reach handlers' :
                     index === 4 ? 'Eco-friendly electric equipment' :
                     index === 5 ? 'Foundation & drilling equipment' :
                     index === 6 ? 'Parts & maintenance supplies' :
                     index === 7 ? 'Heavy construction machinery' :
                     'Professional mining solutions'}
                  </div>
                </div>
                <svg class="w-4 h-4 text-gray-400 ml-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                </svg>
              </a>
            ))}
            <div class="dropdown-footer bg-gray-50 px-6 py-4 border-t border-gray-200">
              <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">
                  <span class="font-medium">Need help choosing?</span>
                  <br>Contact our product specialists
                </div>
                <a href="/contact" class="bg-red-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-red-700 transition-colors">
                  Get Quote
                </a>
              </div>
            </div>
          </div>
        )}
      </div>
  ))}
</nav>

  <!-- å³ä¾§åŠŸèƒ½åŒº -->
  <div class="flex items-center space-x-4">
    <!-- æœç´¢æ¡† -->
    <div class="relative">
      <input 
        type="text" 
        placeholder="Please enter the keyword" 
        class="round bg-red-500/95 border border-red-400/30 text-white placeholder-white/70 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-200"
        style="width: 30rem; font-size: 1.4rem;"
      />
      <button class="absolute right-2 top-1/2 transform -translate-y-1/2">
        <svg class="w-5 h-5 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </button>
    </div>

    <!-- è´­ç‰©è½¦å›¾æ ‡å’Œåœ°çƒå›¾æ ‡ - æŒ‰åŸå‹å›¾æ ·å¼ -->
    <div class="flex items-center">
      <!-- è´­ç‰©è½¦å›¾æ ‡ -->
      <button class="text-white hover:text-white/80 transition-colors duration-200 p-2">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m7.5-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6"/>
        </svg>
      </button>

      <!-- å‚ç›´åˆ†éš”çº¿ -->
      <div class="border-l border-white/30 h-8 mx-6"></div>

      <!-- åœ°çƒå›¾æ ‡ -->
      <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10"/>
        <path d="M2 12h20"/>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
      </svg>
    </div>

    <!-- è¯­è¨€é€‰æ‹©å™¨ -->
    <div class="relative flex items-center space-x-2">
      
      <!-- é€‰æ‹©å™¨æ¡† -->
      <button id="language-selector" class="flex items-center space-x-2 bg-transparent border border-white/30 rounded px-3 py-2 text-white hover:bg-white/10 transition-all duration-200" style="font-size: 1.4rem;">
        <span>English</span>
        <svg class="w-4 h-4 transition-transform duration-200" id="language-arrow" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
        </svg>
      </button>

      <!-- ä¸‹æ‹‰èœå• -->
      <div id="language-dropdown" class="absolute top-full right-0 mt-1 bg-white rounded-md shadow-lg border border-gray-200 overflow-hidden z-50 hidden" style="min-width: 16rem;">
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="en">
          <span class="text-2xl">ğŸ‡ºğŸ‡¸</span>
          <span class="text-gray-800 font-medium">English</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="ru">
          <span class="text-2xl">ğŸ‡·ğŸ‡º</span>
          <span class="text-gray-800 font-medium">Ğ ÑƒÑÑĞºĞ¸Ğ¹</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="es">
          <span class="text-2xl">ğŸ‡ªğŸ‡¸</span>
          <span class="text-gray-800 font-medium">EspaÃ±ol</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="pt">
          <span class="text-2xl">ğŸ‡µğŸ‡¹</span>
          <span class="text-gray-800 font-medium">PortuguÃªs</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="fr">
          <span class="text-2xl">ğŸ‡«ğŸ‡·</span>
          <span class="text-gray-800 font-medium">FranÃ§ais</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="ar">
          <span class="text-2xl">ğŸ‡¸ğŸ‡¦</span>
          <span class="text-gray-800 font-medium">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="de">
          <span class="text-2xl">ğŸ‡©ğŸ‡ª</span>
          <span class="text-gray-800 font-medium">Deutsch</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="it">
          <span class="text-2xl">ğŸ‡®ğŸ‡¹</span>
          <span class="text-gray-800 font-medium">Italiano</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="tr">
          <span class="text-2xl">ğŸ‡¹ğŸ‡·</span>
          <span class="text-gray-800 font-medium">TÃ¼rk</span>
        </a>
        <a href="#" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200 language-option" data-lang="id">
          <span class="text-2xl">ğŸ‡®ğŸ‡©</span>
          <span class="text-gray-800 font-medium">Indonesia</span>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- ç§»åŠ¨ç«¯èœå•å†…å®¹ -->
<div id="mobile-menu-items" class="hidden">
  {menuItems.map((item, index) => (
    <a 
      href={item.path} 
      class={`block text-white hover:text-red-400 rounded-lg px-4 py-3 font-semibold focus-visible-ring touch-manipulation mobile-menu-item border-b border-gray-600 last:border-b-0 ${index === 0 ? 'mobile-active' : ''}`}
      data-path={item.path}
      data-index={index}
    >
      {item.name}
    </a>
  ))}
</div>

<script>
  // ç«‹å³æ‰§è¡Œï¼Œä¸ç­‰å¾…DOMå®Œå…¨åŠ è½½
  (function initMenu() {
    // å¦‚æœDOMè¿˜æœªå‡†å¤‡å¥½ï¼Œåˆ™ç­‰å¾…
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMenuComponents);
    } else {
      // DOMå·²å‡†å¤‡å¥½ï¼Œç«‹å³æ‰§è¡Œ
      initMenuComponents();
    }
  })();

  function initMenuComponents() {
    // ç§»åŠ¨ç«¯èœå•åˆå§‹åŒ–
    const mobileMenuItems = document.getElementById('mobile-menu-items');
    const mobileContainer = document.getElementById('mobile-smart-menu');
    
    if (mobileMenuItems && mobileContainer) {
      // å¤åˆ¶èœå•é¡¹åˆ°ç§»åŠ¨ç«¯å®¹å™¨
      mobileContainer.innerHTML = mobileMenuItems.innerHTML;
      
      // ä¸ºç§»åŠ¨ç«¯èœå•é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
      mobileContainer.querySelectorAll('.mobile-menu-item').forEach(link => {
        link.addEventListener('click', () => {
          // ç§»é™¤æ‰€æœ‰ç§»åŠ¨ç«¯èœå•é¡¹çš„é€‰ä¸­çŠ¶æ€
          mobileContainer.querySelectorAll('.mobile-menu-item').forEach(item => {
            item.classList.remove('mobile-active');
          });
          
          // ä¸ºå½“å‰ç‚¹å‡»çš„èœå•é¡¹æ·»åŠ é€‰ä¸­çŠ¶æ€
          link.classList.add('mobile-active');
          
          // å…³é—­ç§»åŠ¨ç«¯èœå•
          const mobileMenu = document.getElementById('mobile-menu');
          const menuButton = document.getElementById('mobile-menu-button');
          const openIcon = document.getElementById('menu-open-icon');
          const closeIcon = document.getElementById('menu-close-icon');
          
          if (mobileMenu) {
            mobileMenu.classList.add('hidden');
            if (menuButton) menuButton.setAttribute('aria-expanded', 'false');
            if (openIcon) openIcon.classList.remove('hidden');
            if (closeIcon) closeIcon.classList.add('hidden');
          }
        });
      });
    }

    // è¯­è¨€é€‰æ‹©å™¨åŠŸèƒ½
    const languageSelector = document.getElementById('language-selector');
    const languageDropdown = document.getElementById('language-dropdown');
    const languageArrow = document.getElementById('language-arrow');
    
    if (languageSelector && languageDropdown && languageArrow) {
      // åˆ‡æ¢ä¸‹æ‹‰èœå•
      languageSelector.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const isHidden = languageDropdown.classList.contains('hidden');
        
        if (isHidden) {
          languageDropdown.classList.remove('hidden');
          languageArrow.style.transform = 'rotate(180deg)';
        } else {
          languageDropdown.classList.add('hidden');
          languageArrow.style.transform = 'rotate(0deg)';
        }
      });

      // è¯­è¨€é€‰é¡¹ç‚¹å‡»äº‹ä»¶
      const languageOptions = document.querySelectorAll('.language-option');
      languageOptions.forEach(option => {
        option.addEventListener('click', (e) => {
          e.preventDefault();
          const selectedTextElement = option.querySelector('span:last-child');
          const selectorText = languageSelector.querySelector('span');
          if (selectedTextElement && selectorText && selectedTextElement.textContent) {
            selectorText.textContent = selectedTextElement.textContent;
          }
          
          // å…³é—­ä¸‹æ‹‰èœå•
          languageDropdown.classList.add('hidden');
          languageArrow.style.transform = 'rotate(0deg)';
        });
      });

      // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
      document.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (target && !languageSelector.contains(target) && !languageDropdown.contains(target)) {
          languageDropdown.classList.add('hidden');
          languageArrow.style.transform = 'rotate(0deg)';
        }
      });
    }

    // ä¸‹æ‹‰èœå•åŠŸèƒ½
    function initDropdownMenus() {
      const dropdownContainers = document.querySelectorAll('.dropdown-container');
      
      dropdownContainers.forEach(container => {
        const menuItem = container.querySelector('.menu-item') as HTMLElement;
        const dropdownMenu = container.querySelector('.dropdown-menu') as HTMLElement;
        const dropdownArrow = container.querySelector('.dropdown-arrow') as HTMLElement;
        
        if (menuItem && dropdownMenu) {
          // é¼ æ ‡æ‚¬åœæ˜¾ç¤ºä¸‹æ‹‰èœå•
          container.addEventListener('mouseenter', () => {
            dropdownMenu.classList.remove('hidden');
            if (dropdownArrow) {
              dropdownArrow.style.transform = 'rotate(180deg)';
            }
          });
          
          // é¼ æ ‡ç¦»å¼€éšè—ä¸‹æ‹‰èœå•
          container.addEventListener('mouseleave', () => {
            dropdownMenu.classList.add('hidden');
            if (dropdownArrow) {
              dropdownArrow.style.transform = 'rotate(0deg)';
            }
          });
          
          // ç‚¹å‡»ä¸»èœå•é¡¹çš„å¤„ç†
          menuItem.addEventListener('click', (e) => {
            // å¦‚æœæœ‰å­èœå•ï¼Œé˜»æ­¢é»˜è®¤è·³è½¬ï¼Œæ˜¾ç¤ºä¸‹æ‹‰èœå•
            if (dropdownMenu) {
              e.preventDefault();
              const isHidden = dropdownMenu.classList.contains('hidden');
              
              // å…³é—­å…¶ä»–æ‰€æœ‰ä¸‹æ‹‰èœå•
              document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu !== dropdownMenu) {
                  menu.classList.add('hidden');
                }
              });
              
              // åˆ‡æ¢å½“å‰ä¸‹æ‹‰èœå•
              if (isHidden) {
                dropdownMenu.classList.remove('hidden');
                if (dropdownArrow) {
                  dropdownArrow.style.transform = 'rotate(180deg)';
                }
              } else {
                dropdownMenu.classList.add('hidden');
                if (dropdownArrow) {
                  dropdownArrow.style.transform = 'rotate(0deg)';
                }
              }
            }
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            updateActiveMenuItem(menuItem);
          });
        }
      });
      
      // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æ‰€æœ‰ä¸‹æ‹‰èœå•
      document.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (target && !target.closest('.dropdown-container')) {
          document.querySelectorAll('.dropdown-menu').forEach(menu => {
            menu.classList.add('hidden');
          });
          document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
            (arrow as HTMLElement).style.transform = 'rotate(0deg)';
          });
        }
      });
    }
    
    // æ›´æ–°èœå•é€‰ä¸­çŠ¶æ€
    function updateActiveMenuItem(clickedItem: HTMLElement) {
      const menuItems = document.querySelectorAll('.menu-item');
      
      // ç§»é™¤æ‰€æœ‰èœå•é¡¹çš„activeçŠ¶æ€
      menuItems.forEach(menuItem => {
        menuItem.classList.remove('active');
      });
      
      // ä¸ºå½“å‰ç‚¹å‡»çš„èœå•é¡¹æ·»åŠ activeçŠ¶æ€
      clickedItem.classList.add('active');
      
      // å‚¨å­˜é€‰ä¸­çŠ¶æ€åˆ°sessionStorageï¼Œç”¨äºé¡µé¢é—´ä¿æŒçŠ¶æ€
      const href = clickedItem.getAttribute('href');
      if (href) {
        sessionStorage.setItem('activeMenuItem', href);
      }
    }
    
    // æ¡Œé¢ç«¯èœå•é¡¹ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼ˆæ— ä¸‹æ‹‰èœå•çš„é¡¹ç›®ï¼‰
    function initMenuSelection() {
      const menuItems = document.querySelectorAll('.menu-item:not(.has-dropdown)');
      
      menuItems.forEach((item) => {
        item.addEventListener('click', (e) => {
          updateActiveMenuItem(item as HTMLElement);
          // å…è®¸æ­£å¸¸å¯¼èˆª
        });
      });
    }
    
    // è®¾ç½®å½“å‰é¡µé¢èœå•é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
    function setActiveMenuItem() {
      const currentPath = window.location.pathname;
      const menuItems = document.querySelectorAll('.menu-item');
      
      // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰æœåŠ¡ç«¯æ¸²æŸ“çš„é€‰ä¸­çŠ¶æ€
      const hasActiveItem = Array.from(menuItems).some(item => item.classList.contains('active'));
      
      if (!hasActiveItem) {
        // å¦‚æœæ²¡æœ‰é¢„è®¾çš„é€‰ä¸­çŠ¶æ€ï¼Œè¿›è¡Œå®¢æˆ·ç«¯è®¾ç½®
        let foundMatch = false;
        
        menuItems.forEach(item => {
          const href = item.getAttribute('href') || item.getAttribute('data-path');
          if (href === currentPath || (currentPath === '/' && href === '/')) {
            item.classList.add('active');
            foundMatch = true;
          }
        });
        
        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œé»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª
        if (!foundMatch && menuItems.length > 0) {
          menuItems[0].classList.add('active');
        }
      }
      
      // ç¡®ä¿åªæœ‰ä¸€ä¸ªèœå•é¡¹è¢«é€‰ä¸­
      const activeItems = document.querySelectorAll('.menu-item.active');
      if (activeItems.length > 1) {
        // å¦‚æœæœ‰å¤šä¸ªé€‰ä¸­é¡¹ï¼Œåªä¿ç•™ç¬¬ä¸€ä¸ª
        for (let i = 1; i < activeItems.length; i++) {
          activeItems[i].classList.remove('active');
        }
      }
    }
    
    // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
    initDropdownMenus();
    initMenuSelection();
    setActiveMenuItem();
    
    // æ ‡è®°èœå•å·²åŠ è½½å®Œæˆ
    const nav = document.querySelector('nav');
    if (nav) {
      nav.classList.add('menu-loaded');
    }
  }
</script>

<style>
  .menu-item {
    position: relative;
    overflow: hidden;
    height: 6rem;
    min-width: 15rem;
    transition: background-color 0.15s ease;
  }
  
  /* åŸºç¡€èœå•é¡¹æ ·å¼ */
  .menu-item {
    background-color: transparent;
    color: white;
  }
  
  /* é¢„è®¾é€‰ä¸­çŠ¶æ€å·²é€šè¿‡æœåŠ¡ç«¯æ¸²æŸ“å¤„ç†ï¼Œç§»é™¤CSSé¢„è®¾ */
  
  /* é€‰ä¸­çŠ¶æ€ - å½“å‰é¡µé¢ */
  .menu-item.active {
    background-color: #b91c1c !important;
    color: white !important;
  }
  
  /* HoverçŠ¶æ€ - ä½†ä¸è¦†ç›–activeçŠ¶æ€ */
  .menu-item:hover:not(.active) {
    background-color: #b91c1c;
    color: white;
  }
  
  /* èœå•åˆå§‹çŠ¶æ€ - é˜²æ­¢é—ªçƒ */
  nav {
    visibility: visible;
    opacity: 1;
  }
  
  /* èœå•åŠ è½½å®ŒæˆçŠ¶æ€ */
  nav.menu-loaded {
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* èœå•å®¹å™¨é¢„åŠ è½½ä¼˜åŒ– */
  .dropdown-container {
    will-change: transform;
  }
  
  /* é˜²æ­¢é¡µé¢è·³è½¬æ—¶çš„é—ªçƒ */
  .menu-item {
    will-change: background-color;
  }
  
  /* é¡µé¢åŠ è½½æ—¶çš„å¹³æ»‘è¿‡æ¸¡ */
  @media (prefers-reduced-motion: no-preference) {
    .menu-item {
      transition: background-color 0.15s ease-out;
    }
  }
  
  /* ç§»é™¤åŸæ¥çš„åŠ¨ç”»æ•ˆæœ */
  .menu-item::before {
    display: none;
  }
  
  /* ä¸‹æ‹‰èœå•å®¹å™¨ */
  .dropdown-container {
    position: relative;
  }
  
  /* ä¸‹æ‹‰èœå•æ ·å¼ */
  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
    z-index: 1000;
    min-width: 32rem;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-15px) scale(0.95);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* ä¸‹æ‹‰èœå•æ˜¾ç¤ºçŠ¶æ€ */
  .dropdown-menu:not(.hidden) {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }
  
  /* ä¸‹æ‹‰èœå•å¤´éƒ¨ */
  .dropdown-header h3 {
    margin: 0;
    font-size: 1.8rem;
  }
  
  .dropdown-header p {
    margin: 0;
    font-size: 1.4rem;
  }
  
  /* äº§å“èœå•é¡¹æ ·å¼ */
  .product-menu-item {
    position: relative;
    transition: all 0.2s ease;
  }
  
  .product-menu-item:hover {
    background: linear-gradient(to right, #fef2f2, #ffffff);
    transform: translateX(8px);
  }
  
  .product-menu-item:hover .menu-icon {
    background-color: #dc2626;
    color: white;
    transform: scale(1.1);
  }
  
  .product-menu-item .menu-icon {
    transition: all 0.2s ease;
  }
  
  /* ç‰¹è‰²èœå•é¡¹ */
  .featured-item {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-left: 4px solid #dc2626;
  }
  
  .featured-item .menu-icon {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    color: white;
  }
  
  /* ä¸‹æ‹‰èœå•åº•éƒ¨ */
  .dropdown-footer {
    background: linear-gradient(to right, #f9fafb, #f3f4f6);
  }
  
  /* ä¸‹æ‹‰ç®­å¤´åŠ¨ç”» */
  .dropdown-arrow {
    transition: transform 0.2s ease;
  }
  
  /* æœ‰ä¸‹æ‹‰èœå•çš„èœå•é¡¹ */
  .has-dropdown {
    position: relative;
  }
  
  /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
  @media (max-width: 768px) {
    .mobile-menu-item {
      padding: 12px 16px;
      font-size: 16px;
    }
    
    /* ç§»åŠ¨ç«¯é€‰ä¸­çŠ¶æ€ */
    .mobile-menu-item.mobile-active {
      background-color: #b91c1c !important;
      color: white !important;
    }
    
    /* ç§»åŠ¨ç«¯é»˜è®¤ç¬¬ä¸€ä¸ªé€‰ä¸­ */
    .mobile-menu-item[data-index="0"] {
      background-color: #b91c1c;
      color: white;
    }
  }
</style> 