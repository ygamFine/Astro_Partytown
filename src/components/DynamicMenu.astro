import { getMenus } from '../lib/strapi.js';

// 构建时获取初始菜单数据
const initialMenus = await getMenus();

<nav id="dynamic-menu" class="hidden md:flex items-center space-x-6">
  {initialMenus.map(menu => (
    <a 
      href={menu.path} 
      class="text-gray-700 hover:text-red-600 transition-colors duration-200 font-medium"
    >
      {menu.name}
    </a>
  ))}
</nav>

<script define:vars={{ STRAPI_BASE_URL: 'http://47.251.126.80/api', STRAPI_TOKEN: '2980bc69d09c767b2ca2e1c211a285c9f48985775a3f1d1313025838a611abbfe6d892a29b3417407ddd798d69a9f67f063c27d13827c1765f96b4bc19601295ac11fb9552f4a16ede2745813e3b536827069875ae8c5089a36da57cf69d08b252093e2100e0cc88ac700ca6cd6ebd196f0002bd5fb8219222ed778f8858ad21' }}>
  // 客户端动态更新菜单
  async function updateMenu() {
    try {
      const response = await fetch(`${STRAPI_BASE_URL}/menus`, {
        headers: {
          'Authorization': `Bearer ${STRAPI_TOKEN}`,
          'Content-Type': 'application/json'
        },
        cache: 'no-cache'
      });
      
      if (!response.ok) {
        console.log('⚠️ 无法获取最新菜单，使用构建时数据');
        return;
      }
      
      const data = await response.json();
      const menus = data.data?.map(item => ({
        name: item.name,
        path: item.path,
        publishedAt: item.publishedAt
      })) || [];
      
      // 更新菜单DOM
      const menuContainer = document.getElementById('dynamic-menu');
      if (menuContainer && menus.length > 0) {
        menuContainer.innerHTML = menus.map(menu => 
          `<a href="${menu.path}" class="text-gray-700 hover:text-red-600 transition-colors duration-200 font-medium">${menu.name}</a>`
        ).join('');
        
        console.log(`✅ 菜单已更新，显示 ${menus.length} 个菜单项`);
      }
      
    } catch (error) {
      console.log('⚠️ 菜单更新失败，保持构建时数据:', error.message);
    }
  }
  
  // 页面加载时检查更新
  document.addEventListener('DOMContentLoaded', () => {
    // 延迟1秒后检查更新，避免影响首次加载
    setTimeout(updateMenu, 1000);
    
    // 每30秒检查一次更新
    setInterval(updateMenu, 30000);
  });
</script> 